---
title: showSelected
layout: default
output: bookdown::html_chapter
---

Traduction de [English](https://github.com/tdhock/animint-book/) [Ch03-showSelected](https://raw.githubusercontent.com/tdhock/animint-book/master/Ch03-showSelected.Rmd)

# Chapitre 3, le mot-clé showSelected

```{r setup, echo=FALSE}
knitr::opts_chunk$set(fig.path="Ch03-figures/")
```

Ce chapitre explique showSelected, l'un des deux principaux mots-clés qui permettent à l'utilisateur d'avoir accès à l'information. animint introduit pour la visualisation de données interactive. Après avoir lu ce chapitre, vous serez en mesure de

-   Utiliser le mot-clé showSelected dans vos dessins du graphe pour spécifier des éléments graphiques. pour lesquels seul un sous-ensemble de données doit être tracé à tout moment.
-   Utiliser les menus de sélection dans animint pour modifier le sous-ensemble de données tracées.
-   Specifier les transitions entre les sous-ensembles de données à l'aide de l'option de durée et de l'esthétique des touches.
-   Créer des visualisations de données animées à l'aide de l'option de durée.

## Dessiner avec showSelected {#sketching}

Dans cette section, nous allons expliquer comment le mot-clé showSelected peut être utilisé pour créer des croquis dans les dessins du graphe. Le mot-clé showSelected spécifie une variable à utiliser pour le sous-ensemble des données avant le tracé. Chaque élément graphique d'un fichier de données possède son propre ensemble de données et sa propre définition de l'attribut showSelected. Cela signifie que des éléments graphiques différents peuvent spécifier des variables différents jeux de données et mots-clés showSelected pour afficher différents sous-ensembles de données.

En fait, nous avons déjà utilisé le mot-clé showSelected, qui était automatiquement créé par les légendes interactives que nous avons créées dans les deux chapitres précédents. Par exemple, considérons le dessin ci-dessous de la [visualisation de données de la courbe de Keeling du chapitre 1](Ch01-motivation.html#large-data).

![Visualisation des données sur le CO2](Ch03-viz-co2.png)

Le dessin ci-dessus comprend `showSelected=month` pour le `geom_point`, ce qui signifie qu'il doit afficher le sous-ensemble de données pour la catégorie sélectionnée mois sélectionnés. En revanche, étant donné que le `geom_line` n'inclut pas `showSelected` il affiche toujours l'ensemble des données (indépendamment des mois sélectionnés).

Prenons un autre exemple : le dessin ci-dessous de la première Banque mondiale du chapitre 2.

![Visualisation des données de la Banque mondiale avec showSelected](Ch03-viz-showSelectedColor.png)

Le dessin ci-dessus fournit (ou donné ou spécifié) `showSelected=region` pour le `geom_point`, ce qui signifie qu'il doit afficher le sous-ensemble de données pour l'élément sélectionné sélectionnées.

Notez que le code que nous avons utilisé dans le chapitre 2 n'a pas spécifié explicitement `showSelected=region`. Au lieu de cela, nous avons fourni (ou donné ou spécifié) `aes(color=region)` et animint a automatiquement attribué un mot-clé showSelected. En général, animint attribue un mot-clé showSelected pour chaque variable utilisée dans une légende qualitative.

Cependant, le mot-clé showSelected n'est pas limité à une utilisation avec les variables avec les légendes qualitatives. Vous pouvez utiliser les mots-clés showSelected pour toutes les données que vous souhaitez, en spécifiant explicitement les noms des variables dans la section showSelected de l'argument de la commande geom.

Chaque variable utilisée avec showSelected est traitée par animint comme une *variable de sélection*. Par exemple, les données de la courbe de Keeling viz a une variable de sélection (le mois), tout comme les données de la Banque mondiale (région). Pour chaque variable de sélection, animint garde la trace de la valeurs actuellement sélectionnées. Lorsque la sélection change, animint met à jour le sous-ensemble de données affiché.

Chacune des visualisations de données dessinées ci-dessus ne comporte qu'une seule sélection de sélection. Cependant, une visualisation de données peut avoir un nombre quelconque de variables de sélection. variables de sélection. Dans la section suivante, nous étudierons une visualisation des données de la Banque mondiale qui a des variables de sélection pour `region` et `year`.

## Sélection de sous-ensembles de données à l'aide de menus {#selecting-with-menus}

Considérons le dessin suivant, qui ajoute un élément `showSelected` variable, et modifie l'ensemble des données.

![Viz de données de la Banque mondiale avec showSelected](Ch03-viz-scatter.png)

Notez qu'il y a deux `showSelected` variables, `region` et `year`. Notez également que les données sont fournies ou données ou spécifiées comme étant toutes les années (mais seulement une seule sera affichée à la fois en raison de la `showSelected=year`). Ci-dessous, nous traduisons ce dessin en code R.

```{r}
library(animint2)
data(WorldBank)
scatter <- ggplot()+
  geom_point(aes(
    x=life.expectancy, y=fertility.rate, color=region),
    showSelected="year",
    data=WorldBank)
scatter
```

Notez que le ggplot ci-dessus contient l'élément `showSelected` l'argument des deux principales caractéristiques introduites dans animint2. L'argument `showSelected` est ignoré lors du rendu du graphe à l'aide des outils graphiques habituels de R qui produisent un nuage de points avec un point pour chaque pays. et chaque année. Il convient de noter que, puisque le mot-clé `color=region` a été fourni, animint a également utilise automatiquement `region` comme `showSelected` variable.

En revanche, le rendu du même ggplot en utilisant animint donne le résultat suivant visualisation de données interactive ci-dessous.

```{r Ch03-viz-scatter}
animint(scatter)
```

Notez que la visualisation de données ci-dessus comporte deux variables de sélection : région et l'année. Chaque variable dispose d'un menu en bas de l'image de données qui permet de être utilisé pour modifier la sélection en cours. Dans cette image de données, ces menus de sélection sont affichés par défaut. Ils peuvent être masqués en cliquant sur le bouton "Cacher les menus de sélection", et les afficher à nouveau en cliquant sur le bouton "Cacher les menus de sélection". "Afficher les menus de sélection".

Les variables discrètes de la légende, telles que la région, sont par défaut multiples. plusieurs valeurs sont donc sélectionnées et affichées en même temps. **Essayer** de changer la région sélectionnée dans la légende interactive et dans la fenêtre d'affichage. menu de sélection. Lorsque vous modifiez la sélection à l'aide de l'une ou l'autre méthode, la légende interactive et le menu de sélection doivent être mis à jour. pour refléter la sélection actuelle.

Nous utilisons les termes "manipulation directe" et "manipulation indirecte" pour pour décrire ces différentes manières de modifier la sélection. Manipulation directe directe consiste généralement à cliquer sur les objets que vous souhaitez modifier et est généralement plus facile à comprendre. En revanche, la manipulation indirecte telles que les menus, sont généralement plus compliquées compliquées à comprendre. Dans l'animint ci-dessus, vous pouvez modifier la valeur de l'élément `region` en utilisant soit la légende, soit le menu. L'utilisation de la est une technique de manipulation plus directe, puisque la légende est plus proche des points de données tracés qui seront mis à jour.

D'autres variables de sélection, telles que l'année, sont sélectionnées par défaut. une seule valeur est sélectionnée et affichée à tout moment. **Essai** de changer la la valeur sélectionnée de la variable année à l'aide du menu de sélection. Vous avez devriez voir les points du nuage de points se mettre à jour immédiatement pour montrer les points de l'année. le taux de fécondité et l'espérance de vie de tous les pays de la région. année que vous avez sélectionnée.

**Exercice à plusieurs niveaux :** Ajoutez un autre élément graphique à cet exercice interactif. nuage de points interactif. Comme dans [Chapitre 2](Ch02-ggplot2.html#multi-layer) vous pouvez utiliser un `geom_text` pour afficher le nom de chaque pays (facile), ou un `geom_text` pour afficher l'année sélectionnée (moyen), ou a `geom_path` pour pour afficher les données des 5 années précédentes (hard). Conseil : veillez à spécifier `showSelected=year` pour tous les éléments graphiques.

**Exercice sur plusieurs graphes :** Ajouter un gracé de série temporelle à la viz de données ci-dessus. Comme dans [Chapitre 2](Ch02-ggplot2.html#multi-plot) vous pouvez utiliser un `geom_line` pour montrer le taux de fécondité de chaque pays sur l'ensemble des pays de l'UE. années. Ajouter un `geom_vline` avec `showSelected=year` pour mettre en évidence le l'année sélectionnée.

## Transitions : l'option de la durée et l'esthétique clé {#duration-key}

Vous avez peut-être remarqué qu'il y a des boutons au bas de chaque donnée de données créées par animint. Essayez de cliquer sur le bouton "Montrer l'animation ci-dessus. Ce tableau contient une ligne pour chaque sélection de sélection. Les zones de texte indiquent le nombre de millisecondes utilisées. pour les durées de transition après la mise à jour de chaque variable de sélection. Les La durée de transition par défaut pour chaque variable de sélection est de 0, ce qui signifie que la durée de transition pour chaque variable de sélection est de 0. les données seront immédiatement placées à leur nouvelle position après la mise à jour des variables de sélection. chaque variable.

Pour illustrer l'importance des durées de transition, **essayez** de changer la durée de transition de la variable année en 2000. Dans ce cas, modifiez la valeur sélectionnée de la variable year. Vous devriez voir apparaître l'icône points de données se déplacer lentement vers leurs nouvelles positions, sur une durée de 2 secondes.

Certaines transitions n'entraînent qu'un léger déplacement des points, qui se retrouvent à proximité de leur position d'origine. positions proches (par exemple 1979-1980). D'autres transitions entraînent le déplacement de points beaucoup plus, vers des localisations plus éloignées (par exemple 1980-1981). Comment cela se fait-il ?

Les transitions douces n'ont de sens que pour les points de données qui existent à la fois dans le temps et dans l'espace. avant et après la modification de la sélection. Dans le code R ci-dessous, nous calculons un tableau de contingences des points de données qui peuvent être tracés dans chaque de ces trois années.

```{r}
three.years <- subset(WorldBank, 1979 <= year & year <= 1981)
can.plot <- with(three.years, {
  (!is.na(life.expectancy)) & (!is.na(fertility.rate))
})
table(three.years$year, can.plot)
```

Il ressort clairement du tableau de contingence ci-dessus qu'il y a 187 points qui peuvent être tracés pour chacune des trois années. tracés en 1979 et 1980. Cependant, en 1981, il y a une donnée de plus correspondant à un pays pour lequel nous n'avions pas de données en 1981. 1980. Nous présentons ci-dessous les données de ce pays, le Kosovo.

```{r}
subset(three.years, country=="Kosovo")
```

En effet, le tableau de contingence ci-dessus montre que le taux de fécondité et l'espérance de vie sont manquants pour le Kosovo durant la période 1979-1980. Il n'est donc pas logique d'effectuer une transition en douceur pour des pays tels que le Kosovo, qui n'aurait pas être tracé ni avant ni après la transition. Comment fournir (ou donné ou spécifié) dans la visualisation de données ? Dans le code ci-dessous, nous utilisons `aes(key=country)` pour spécifier que l'élément `country` doit être pour faire correspondre les points de données avant et après la modification de la sélection.

```{r}
scatter.key <- ggplot()+
  geom_point(aes(
    x=life.expectancy, y=fertility.rate, color=region,
    key=country),
    showSelected="year",
    data=WorldBank)
```

Le `key` dans le ggplot ci-dessus n'a de sens que pour l'aspect la visualisation de données interactive, elle est donc ignorée lors du rendu avec l'option périphériques graphiques habituels de R. Cependant, si nous rendons ce ggplot en utilisant animint2, l'élément `country` sera utilisée pour s'assurer que les durées de transtion sont significatives. Pour spécifier une variable fournie (ou donné ou spécifié) pour la variable `year` nous utilisons l'option `duration` dans les données ci-dessous.

```{r Ch03-viz-duration}
(viz.duration <- animint(scatter.key, duration=list(year=2000)))
```

L'option `duration` doit être une liste nommée. Chaque nom doit être un variable de sélection, et chaque valeur doit spécifier le nombre de millisecondes à utiliser pour la durée de la transition lorsque la valeur sélectionnée de cette variable est modifiée.

Si vous cliquez sur "Afficher les contrôles d'animation" dans l'image de données ci-dessus, vous obtiendrez les informations suivantes que la zone de texte pour la variable année est 2000, comme fourni (ou donné ou spécifié). le code R. Si vous changez la sélection de 1980 à 1981, vous devez une transition correcte.

En général, les `key` esthétique doit être fourni (ou choisi ou spécifié) pour tous les éléments graphiques qui utilisent `showSelected` avec une variable qui apparaît dans l'élément `duration` . Dans cet exemple, nous avons utilisé la variable `duration` pour fournir (ou donné ou spécifié) un transition en douceur pour le `year` pour la variable. Puisque nous utilisons `showSelected=year` dans la `geom_point`, nous avons également fourni (ou donné ou spécifié) le `key` esthétique de ces éléments graphiques.

## Animation : l'option temps {#animation-time}

L'option `time` permet de spécifier une variable à utiliser pour l'animation.

```{r Ch03-viz-duration-time}
viz.duration.time <- viz.duration
viz.duration.time$time <- list(variable="year", ms=2000)
viz.duration.time
```

**Exercice :** Réaliser une visualisation de données animée qui n'utilise pas de de transitions douces. Conseil : faites une liste de ggplots qui a le format `time` mais pas l'option `duration` option.

## Résumé du chapitre et exercices {#exercises}

Ce chapitre a expliqué l'esthétique showSelected, les menus de sélection, les durées de transition et l'animation.

Exercices :

-   Réaliser une version améliorée de `viz.aligned` à partir de la version précédente précédent. Au lieu de fixer l'année à 1975, utilisez `showSelected=year` pour que l'utilisateur puisse choisir une année. Ajouter des éléments graphiques qui indiquent l'année sélectionnée : un `geom_text` sur le nuage de points, et a `geom_vline` sur la série chronologique.
-   Traduisez l'un des [exemples de packages d'animation](https://yihui.name/animation/examples/) à une animint. Conseil : dans le code du package d'animation, il y a toujours une boucle for sur la variable time. Au lieu d'appeler un fonction de tracé à l'intérieur de la boucle for, utilisez la fonction [liste de tableaux de données.](Ch99-appendix.html#list-of-data-tables) pour stocker les données qui doivent être tracées. Ces données sont ensuite utilisées avec avec `showSelected` pour créer des ggplots, et les rendre en utilisant animint.

Suivant, [Chapitre 4](Ch04-clickSelects.html) explique les `clickSelects` qui indique un élément graphique sur lequel on peut cliquer pour mettre à jour un variable de sélection.
