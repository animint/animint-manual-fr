---
title: Grammar of graphics
layout: default
output: bookdown::html_chapter
---

# Chapter 2, data visualization using the grammar of graphics {#chapter-2}

```{r setup, echo=FALSE}
knitr::opts_chunk$set(fig.path="Ch02-figures/")
```

Ce chapitre explique la grammaire des graphiques, qui est un modèle puissant pour décrire une grande classe de visualisations de données.
<!-- comment -->
Après avoir lu ce chapitre, vous serez en mesure de
<!-- comment -->
* Citer les avantages de la grammaire graphique par rapport aux systèmes de tracé précédents
<!-- comment -->
* Installer le package R animint2 
<!-- comment -->
* Traduire les dessins de graphe en code ggplot dans R
<!-- comment -->
* Afficher des ggplots sur des pages web en utilisant animint2
<!-- comment -->
* Créer des ggplots multicouches
<!-- comment -->
* Créer des ggplots multi-panneaux

<!-- comment -->

## Historique des commandes et objectif de la grammaire graphique {#history}

<!-- comment -->

La plupart des systèmes informatiques d'analyse de données proposent des fonctions permettant de créer des graphes afin de visualiser les motifs des données.
<!-- comment -->
Les systèmes les plus anciens proposent des fonctions très générales permettant de dessiner les éléments de base d'un graphe, tels que des lignes et des points (par exemple, la fonction `graphics`  et `grid`  dans R).
<!-- comment -->
Si vous utilisez l'un de ces systèmes généraux, c'est à vous qu'il incombe d'assembler les composants pour former un graphe significatif et interprétable.
<!-- comment -->
L'avantage des systèmes généraux est qu'ils imposent peu de limites aux types de tracés qui peuvent être créés.
<!-- comment -->
L'inconvénient est que les systèmes généraux ne fournissent généralement pas de fonctions permettant d'automatiser les tâches courantes de tracé (axes, panneaux, légendes).

<!-- comment -->

Pour pallier les inconvénients de ces systèmes de tracé généraux, des packages de tracé tels que `lattice`  ont été développés ( [Sarkar, 2008](http://lmdvr.r-forge.r-project.org/figures/figures.html) ).
<!-- comment -->
Ces packages disposent de plusieurs types de graphiques prédéfinis et fournissent une fonction dédiée à la création de chaque type de graphique.
<!-- comment -->
 Par exemple, `lattice`  fournit la fonction `bwplot`  pour créer des graphes en boîte et des graphes avec des lignes de démarcation.
<!-- comment -->
L'avantage de ces systèmes est qu'ils facilitent grandement la création de tracés entiers, y compris une légende et des panneaux.
<!-- comment -->
L'inconvénient est l'ensemble des types de graphiques prédéfinis, ce qui signifie qu'il n'est pas facile de créer des graphiques plus complexes.

<!-- comment -->

Les nouveaux systèmes de tracé basés sur la grammaire graphique se situent entre ces deux extrêmes.
<!-- comment -->
Wilkinson a proposé la grammaire graphique afin de décrire et de créer une grande classe de graphes ( [Wilkinson, 2005](http://www.springer.com/us/book/9780387245447?wt_mc=GoogleBooks.GoogleBooks.3.EN&token=gbgen#otherversion=9780387286952) ).
<!-- comment -->
Wickham a implémenté plus tard plusieurs idées de la grammaire graphique dans le projet `ggplot2`  package R ( [Wickham, 2009](https://www.amazon.com/dp/0387981403/ref=cm_sw_su_dp?tag=ggplot2-20) ).
<!-- comment -->
Le package `ggplot2`  présente plusieurs avantages par rapport aux systèmes de tracé précédents.

<!-- comment -->

* Comme les systèmes de tracé généraux, et à la différence de `lattice` , `ggplot2`  impose peu de limites aux types de tracés qui peuvent être créés (il n'y a pas de types de graphiques prédéfinis).
<!-- comment -->
* Contrairement aux systèmes de tracé généraux, et à l'instar de `lattice` , `ggplot2`  permet d'inclure facilement des éléments de graphe courants tels que des axes, des panneaux et des légendes.
<!-- comment -->
* Depuis que `ggplot2`  est basé sur la grammaire des graphiques, il est nécessaire de mapper explicitement les variables de données aux propriétés visuelles. Plus loin dans ce chapitre, nous expliquerons comment ce mappage permet de dessiner des idées de graphe qui peuvent être directement traduites en code R.

<!-- comment -->

Enfin, tous les systèmes de tracé évoqués précédemment sont destinés à la création de graphiques statiques, qui peuvent être visualisés aussi bien sur un écran d'ordinateur que sur du papier.
<!-- comment -->
Cependant, le sujet principal de ce manuel est `animint2` un package R pour les graphiques interactifs.
<!-- comment -->
Contrairement aux graphiques statiques, les graphiques interactifs sont mieux visualisés sur un ordinateur équipé d'une souris et d'un clavier permettant d'interagir avec le graphe.

<!-- comment -->

Étant donné que de nombreux concepts des graphiques statiques sont également utiles dans les graphiques interactifs, le package `animint2`  est implémenté en tant qu'extension/fork du package `ggplot2` .
<!-- comment -->
Dans ce chapitre, nous présenterons les principales caractéristiques de `ggplot2`  qui seront également utiles pour la conception de graphes interactifs dans les chapitres suivants.

<!-- comment -->

En 2013, nous avons créé le package animint, qui dépend du package ggplot2.
<!-- comment -->
Cependant, au cours de la période 2014-2017, le package ggplot2 a introduit de nombreux changements qui étaient incompatibles avec la grammaire interactive de animint.
<!-- comment -->
Par conséquent, en 2018, nous avons créé le package animint2 qui copie/fork les parties pertinentes du package ggplot2.
<!-- comment -->
Maintenant, animint2 peut être utilisé sans que ggplot2 soit installé.
<!-- comment -->
En fait, il est recommandé d'utiliser animint2 sans attacher (via la bibliothèque) ggplot2.
<!-- comment -->
Cependant, il est possible d'utiliser animint2 avec des packages qui importent/chargent ggplot2.
<!-- comment -->
Pour un exemple, voir [Chapitre 16](Ch16-change-point.html) qui utilise le package penaltyLearning (qui importe ggplot2).

<!-- comment -->

## Installer et attacher animint2 {#installing}

<!-- comment -->

Pour installer la version la plus récente de `animint2`  à partir du CRAN,

<!-- comment -->

```{r installCRAN}
if(!requireNamespace("animint2"))install.packages("animint2")
```

<!-- comment -->

Pour installer une version de développement encore plus récente de `animint2`  depuis GitHub,

<!-- comment -->

```{r installGitHub}
if(!requireNamespace("animint2")){
  if(!requireNamespace("remotes"))install.packages("remotes")
  remotes::install_github("tdhock/animint2")
}
```

<!-- comment -->

Une fois que vous avez installé animint2, vous pouvez charger et attacher toutes ses fonctions exportées via :

<!-- comment -->

```{r attach}
library(animint2)
```

<!-- comment -->

## Traduire des dessins de tracés en ggplots {#sketching}

<!-- comment -->

Cette section explique comment traduire une esquisse de graphe en code R.
<!-- comment -->
Nous utilisons un ensemble de données de la Banque mondiale comme exemple, et nous commençons par charger et examiner un sous-ensemble de ces données.

<!-- comment -->

```{r data}
data(WorldBank, package="animint2")
WorldBank$Region <- sub(" (all income levels)", "", WorldBank$region, fixed=TRUE)
head(WorldBank)
tail(WorldBank)
dim(WorldBank)
```

<!-- comment -->

Le jeu de données `WorldBank`  consiste en des mesures telles que le taux de fécondité et l'espérance de vie pour chaque pays sur la période 1960-2010.
<!-- comment -->
Le code ci-dessus imprime les premières et dernières lignes, ainsi que la dimension du tableau de données ( `r nrow(WorldBank)`  lignes et `r ncol(WorldBank)`  colonnes).

<!-- comment -->

Supposons que nous voulions voir s'il existe une relation entre l'espérance de vie et le taux de fécondité
<!-- comment -->
 Nous pourrions fixer une année, puis utiliser ces deux variables de données dans un nuage de points.
<!-- comment -->
La figure ci-dessous esquisse les principaux éléments de cette visualisation de données.

<!-- comment -->

![World Bank scatterplot](Ch02-viz-scatter.png)

<!-- comment -->

L'esquisse ci-dessus montre l'espérance de vie sur l'axe horizontal (x), le taux de fécondité sur l'axe vertical (y) et une légende pour la région.
<!-- comment -->
Ces éléments du dessin peuvent être directement traduits en code R à l'aide de la méthode suivante.
<!-- comment -->
Tout d'abord, nous devons construire un tableau de données comportant une ligne pour chaque pays en 1975, et des colonnes nommées `life.expectancy`, `fertility.rate`, et `region`.
<!-- comment -->
Les données `WorldBank` possèdent déjà ces colonnes, il suffit donc de considérer le sous-ensemble pour l'année 1975 :

<!-- comment -->

```{r head}
WorldBank1975 <- subset(WorldBank, year==1975)
head(WorldBank1975)
```

<!-- comment -->

Le code ci-dessus imprime les données pour 1975, qui ont clairement les colonnes appropriées, et une ligne pour chaque pays
<!-- comment -->
L'étape suivante consiste à utiliser les notes de l'esquisse pour coder un ggplot avec une fonction correspondante de `aes`  ou un mappage esthétique des variables de données aux propriétés visuelles :

<!-- comment -->

```{r scatter}
scatter <- ggplot()+
  geom_point(
    mapping=aes(x=life.expectancy, y=fertility.rate, color=Region),
    data=WorldBank1975)
scatter
```

<!-- comment -->

La fonction `aes`  est appelée avec les noms des propriétés visuelles ( `x` , `y` , `color` ) et les valeurs des variables de données correspondantes ( `life.expectancy` , `fertility.rate` , `region` )
<!-- comment -->
Ce mappage est appliqué aux variables du tableau de données `WorldBank1975`, afin de créer les propriétés de visualisation de la `geom\_point` .
<!-- comment -->
Le ggplot a été sauvegardé en tant qu'objet `scatter`  qui, lorsqu'il est imprimé sur la ligne de commande R, affiche le graphe sur un périphérique graphique.
<!-- comment -->
Notez que nous avons automatiquement une légende `region` en couleur.

<!-- comment -->

## Afficher des ggplots sur des pages web à l'aide d'animint {#rendering-with-animint}

<!-- comment -->

Cette section explique comment l'outil `animint2`  peut être utilisé pour afficher des ggplots sur des pages web.
<!-- comment -->
Le ggplot de la section précédente peut être affiché avec animint2, en utilisant la fonction `animint`

<!-- comment -->

```{r Ch02-scatter}
animint(scatter)
```

<!-- comment -->

Si, lorsque vous exécutez le code ci-dessus, l'animint ne s'affiche pas dans votre explorateur web pour une raison quelconque (par exemple si vous voyez une page web vierge), veuillez consulter notre section [FAQ wiki](https://github.com/tdhock/animint2/wiki/FAQ#web-browser-on-local-indexhtml-file-is-blank)  qui vous aidera à trouver une solution.
<!-- comment -->
En interne, la fonction `animint`  crée une liste de classes animint, puis R exécute la fonction `print.animint`  via la fonction [système d'objets S3](http://adv-r.had.co.nz/OO-essentials.html#s3).
<!-- comment -->
Le package `animint2`  implémente un compilateur qui prend la liste en entrée et produit une page web avec une visualisation de données. 
<!-- comment -->
Le compilateur est la fonction `animint2dir`  qui compile la liste animint `scatter.viz`  en un répertoire de fichiers de données et de code qui peuvent être affichés dans un explorateur web.
<!-- comment -->
Elle est activée automatiquement par la fonction `print.animint`.

<!-- comment -->

Lorsqu'il est visualisé dans un explorateur web, le graphe animint devrait être pratiquement identique aux versions statiques produites par les périphériques graphiques R standard.
<!-- comment -->
Une différence est que la légende de la région est interactive : en cliquant sur une entrée de la légende, les points de cette couleur sont cachés ou affichés.

<!-- comment -->

**Exercice**: essayez de modifier la valeur de `aes`  de la cartographie du ggplot, puis de créer une nouvelle animint.
<!-- comment -->
Les variables quantitatives comme `population`  sont mieux représentées à l'aide des axes `x` / `y`  ou des points `size`.
<!-- comment -->
Les variables qualitatives comme `lending`  sont mieux représentées en utilisant le point `color`  ou `fill`.

<!-- comment -->

## Visualisation de données multicouches (plusieurs geoms) {#multi-layer}

<!-- comment -->

La visualisation de données multicouches est utile lorsque vous souhaitez afficher plusieurs geoms ou ensembles de données différents dans le même graphe.
<!-- comment -->
Par exemple, considérons le dessin suivant qui ajoute une couche de `geom\_path`  à la visualisation de données précédente.

<!-- comment -->

![multi-layer WorldBank data viz](Ch02-two-layer-viz.png)

<!-- comment -->

Notez que le dessin ci-dessus comprend deux geoms différents (point et chemin).
<!-- comment -->
Les deux geoms partagent une définition commune des éléments `x` , `y` , et de l'esthétique `color`, mais avec des ensembles de données différents.
<!-- comment -->
Nous traduisons ci-dessous ce dessin en code R.

<!-- comment -->

```{r Ch02-two-layer-viz}
WorldBankBefore1975 <- subset(WorldBank, 1970 <= year & year <= 1975)
two.layers <- scatter+
  geom_path(aes(
    x=life.expectancy, 
    y=fertility.rate, 
    color=Region,
    group=country),
    data=WorldBankBefore1975)
(viz.two.layers <- animint(two.layers))
```

<!-- comment -->

Notez que nous sauvegardons la valeur de retour de la fonction `animint`  dans l'objet `viz.two.layers`  (qui est également imprimé en raison des parenthèses).
<!-- comment -->
Dans ce manuel, nous utiliserons souvent des noms de variables commençant par `viz`  pour désigner les objets de visualisation de données animint, qui sont en fait des listes de ggplots et d'options.

<!-- comment -->

Le graphe ci-dessus montre une visualisation de données avec 2 geoms/couches : 

<!-- comment -->

* le `geom\_point`  montre l'espérance de vie, le taux de fécondité et la région de tous les pays en 1975.
<!-- comment -->
* le `geom\_path`  montre les mêmes variables pour les 5 années précédentes.

<!-- comment -->

L'ajout de `geom\_path`  montre comment les pays ont changé au fil du temps.
<!-- comment -->
En particulier, il montre que la plupart des pays se sont déplacés vers la droite et vers le bas, ce qui signifie une espérance de vie plus élevée et un taux de fécondité plus faible.
<!-- comment -->
Il y a cependant quelques exceptions.
<!-- comment -->
Par exemple, les deux pays d'Asie de l'Est situés en bas à gauche ont vu leur espérance de vie diminuer au cours de cette période.
<!-- comment -->
Par ailleurs, certains pays ont vu leur taux de fécondité augmenter.

<!-- comment -->

**Exercice**: essayez de changer le `region`  par une légende `income` (revenu).
<!-- comment -->
Conseil : vous devez utiliser la même spécification `aes(color=income)`  pour tous les geoms.
<!-- comment -->
Vous pouvez utiliser `scale\_color\_manual`  avec une palette de couleurs séquentielle, voir `RColorBrewer::display.brewer.all(type="seq")`  et [lire l'annexe pour plus de détails](Ch99-appendix.html#manual-color-legends).
  
<!-- comment -->

Pouvons-nous ajouter les noms des pays à l'image de données ?
<!-- comment -->
Ci-dessous, nous ajoutons une autre couche avec une étiquette de texte pour le nom de chaque pays.

<!-- comment -->

```{r Ch02-three-layer-viz}
three.layers <- two.layers+
  geom_text(aes(
    x=life.expectancy, 
    y=fertility.rate, 
    color=Region,
    label=country),
    data=WorldBank1975)
animint(three.layers)
```

<!-- comment -->

Cette visualisation n'est pas très facile à lire, car il y a beaucoup d'étiquettes de texte qui se chevauchent.
<!-- comment -->
La légende interactive des régions aide un peu, en permettant à l'utilisateur de masquer les données des régions sélectionnées.
<!-- comment -->
Cependant, ce serait encore mieux si l'utilisateur pouvait afficher et masquer le texte pour les pays individuels.
<!-- comment -->
Ce type d'interaction peut être réalisé en utilisant les esthétiques showSelected et clickSelects que nous expliquons dans les chapitres 3-4.

<!-- comment -->

Pour l'instant, nous passons à l'examen d'un atout majeur d'animint : la visualisation de données à l'aide de plusieurs graphes liés.

<!-- comment -->

## Visualisation de données en plusieurs graphes {#multi-plot}

<!-- comment -->

La visualisation de données à plusieurs graphes est utile lorsque vous souhaitez présenter des ensembles de données liés en utilisant plus d'un mappage esthétique.
<!-- comment -->
Dans la visualisation de données interactive, un graphe est souvent utilisé pour afficher un résumé et un autre pour afficher les détails.
<!-- comment -->
Prenons l'exemple d'une visualisation comportant deux graphes : une série chronologique avec les données de la Banque mondiale de 1960 à 2010 (résumé) et un nuage de points avec les données de 1975 (détails).
<!-- comment -->
Nous esquissons ci-dessous le graphe de la série chronologique.

<!-- comment -->

![WorldBank data viz with two plots](Ch02-viz-two-plots.png)

<!-- comment -->

Notez que l'esquisse ci-dessus peut être directement traduite dans le code R ci-dessous. 
<!-- comment -->
Pour plus de simplicité, nous commençons par réduire l'échantillonnage des données à tous les cinq ans (certains explorateurs web comme Chromium ne sont pas en mesure d'afficher plus de 10 000 points de données en une seule fois),

<!-- comment -->

```{r}
WorldBankSome <- subset(WorldBank, year %% 5 == 0)
dim(WorldBankSome)
table(WorldBankSome$year)
```

<!-- comment -->

Le tableau de contingence ci-dessus montre qu'il y a 214 lignes pour chacune des années de l'ensemble de données.
<!-- comment -->
Ensuite, nous copions la liste viz existante ( `viz.two.layers` ), puis nous assignons un ggplot à un nouvel élément nommé `timeSeries`. 

 <!-- comment -->

```{r vizTwoPlots}
viz.two.plots <- viz.two.layers
viz.two.plots$timeSeries <- ggplot()+
  geom_line(aes(
    x=year, 
    y=fertility.rate, 
    color=Region, 
    group=country),
    data=WorldBankSome)
```

<!-- comment -->

Il en résulte une liste nommée de deux éléments (les deux éléments sont des ggplots avec la classe `gganimint`).

<!-- comment -->

```{r summaryTwo}
summary(viz.two.plots)
```

<!-- comment -->

Cette liste de visualisation de données peut être imprimée ou affichée en tapant son nom.
<!-- comment -->
Puisque la liste contient deux ggplots, `animint2`  affiche la visualisation de données sous la forme de deux graphes liés.

<!-- comment -->

```{r Ch02-viz-two-plots}
viz.two.plots
```

<!-- comment -->

La visualisation de données ci-dessus contient deux ggplots, qui mappent chacun des variables de données différentes sur le plan horizontal `x`.
<!-- comment -->
La série temporelle utilise `aes(x=year)` et montre un résumé des valeurs du taux de fécondité pour toutes les années.
<!-- comment -->
Le nuage de points utilise `aes(x=life.expectancy)` et montre les détails de la relation entre le taux de fécondité et l'espérance de vie en 1975.

<!-- comment -->

**Essayez** de cliquer sur une entrée de légende dans le nuage de points ou dans la série chronologique ci-dessus.
<!-- comment -->
Vous devriez voir les données et les légendes des deux graphes se mettre à jour simultanément.
<!-- comment -->
Etant donné que `aes(color=Region)` a été spécifié dans les deux graphes, animint crée une seule variable de sélection partagée appelée `Region`.
<!-- comment -->
Cliquer sur l'une ou l'autre légende a pour effet de mettre à jour l'ensemble des régions sélectionnées, et animint met donc à jour les légendes et les données dans les deux graphes en conséquence.
<!-- comment -->
Il s'agit du mécanisme principal utilisé par animint pour créer des visualisations de données interactives avec des graphes liés, et il sera discuté plus en détail dans les deux prochains chapitres.

<!-- comment -->

**Exercice**: utilisez animint pour créer une visualisation de données avec trois graphes, en créant une liste avec trois ggplots.
<!-- comment -->
Par exemple, vous pouvez ajouter une série temporelle d'une autre variable de données telle que `life.expectancy`  ou `population`.

<!-- comment -->

Notez que les deux ggplots mappent la variable taux de fécondité sur l'axe y.
<!-- comment -->
Cependant, comme il s'agit de deux graphes distincts, les plages (ou intervalles) de leurs axes des ordonnées sont calculées séparément.
<!-- comment -->
Cela signifie que même lorsque les deux graphes sont affichés côte à côte, les deux axes des ordonnées ne sont pas exactement alignés.
<!-- comment -->
C'est un problème car il serait plus facile de décoder la visualisation des données si chaque unité d'espace vertical était utilisée pour montrer la même quantité de taux de fécondité.
<!-- comment -->
Pour obtenir cet effet, nous utilisons les facettes dans la section suivante.

<!-- comment -->

## Visualisation de données multi-panneaux (facettes) {#multi-panel}

<!-- comment -->

Les panneaux ou facettes sont des sous-tracés qui présentent des visualisations de données connectées.
<!-- comment -->
L'un des principaux atouts de ggplots est qu'il est relativement facile de créer différents types de graphes à panneaux multiples.
<!-- comment -->
La visualisation de données multi-panneaux est utile à deux fins différentes :

<!-- comment -->

* Vous souhaitez aligner les axes de plusieurs tracés connexes contenant différents geoms. Cela facilite la comparaison entre plusieurs geoms différents et c'est une technique qui est également utile pour la visualisation interactive des données.
* Vous souhaitez diviser les données d'un geom en plusieurs panneaux. Cette technique facilite la comparaison entre des sous-ensembles de données et est moins utile pour la visualisation interactive de données (l'interactivité peut souvent être utilisée à la place, pour obtenir le même effet de comparaison de sous-ensembles de données).

<!-- comment -->

### Différents geom dans chaque panneau (axes alignés) {#aligned-axes}
  
<!-- comment -->

Nous commençons par expliquer comment les facettes sont utiles pour aligner les axes de graphiques apparentés.
<!-- comment -->
Considérons le dessin ci-dessous qui contient un graphe avec deux panneaux.

<!-- comment -->

![World Bank aligned plot](Ch02-viz-aligned.png)

<!-- comment -->

Notez que les deux panneaux tracent des geoms différents à l'aide d'une cartographie esthétique spécifique au panneau.
<!-- comment -->
Le point et le path dans le panneau de gauche ont `x=life.expectancy` et la ligne du panneau de droite a `x=year` .
<!-- comment -->
Notez également que nous avons spécifié `facet=x.var` nous devons donc ajouter une variable appelée `x.var` à chacun des trois ensembles de données.
<!-- comment -->
Nous traduisons cette esquisse en code R ci-dessous.

<!-- comment -->

```{r Ch02-viz-aligned}
add.x.var <- function(df, x.var){
  data.frame(df, x.var=factor(x.var, c("life expectancy", "year")))
}
(viz.aligned <- animint(
  scatter=ggplot()+
    theme_bw()+
    theme_animint(width=600)+
    geom_point(aes(
      x=life.expectancy, y=fertility.rate, color=Region),
      data=add.x.var(WorldBank1975, "life expectancy"))+
    geom_path(aes(
      x=life.expectancy, y=fertility.rate, color=Region,
      group=country),
      data=add.x.var(WorldBankBefore1975, "life expectancy"))+
    geom_line(aes(
      x=year, y=fertility.rate, color=Region, group=country),
      data=add.x.var(WorldBankSome, "year"))+
    xlab("")+
    facet_grid(. ~ x.var, scales="free")))
```

<!-- comment -->

La visualisation de données ci-dessus contient un seul ggplot avec deux panneaux et trois couches.
<!-- comment -->
Le panneau de gauche montre les `geom\_point` et `geom\_path` et le panneau de droite montre les `geom\_line`.
<!-- comment -->
Les panneaux ont un axe commun pour le taux de fécondité, ce qui permet de comparer directement les lignes du panneau des séries chronologiques avec les points et les chemins du panneau du nuage de points.

<!-- comment -->

Il est à noter que nous avons utilisé la méthode `add.x.var` pour ajouter une variable `x.var` à chaque ensemble de données, puis nous avons utilisé cette variable dans la fonction `facet\_grid(scales="free")`.
<!-- comment -->
Nous appelons cela la fonction [addColumn then facet idiom](Ch99-appendix.html#addColumn-then-facet) qui est généralement utile pour créer une visualisation de données à plusieurs panneaux avec des axes alignés.
<!-- comment -->
En particulier, si nous voulions changer l'ordre des panneaux dans la visualisation, il nous suffirait de modifier l'ordre des niveaux de facteurs dans la définition de `add.x.var` .

<!-- comment -->

Notez également que `theme\_bw`  signifie qu'il faut utiliser des bordures de panneaux noires et des fonds de panneaux blancs, et que `panel.margin=0`  signifie qu'il n'y a pas d'espace entre les panneaux.
<!-- comment -->
En éliminant l'espace entre les panneaux, on utilise plus d'espace pour les panneaux, ce qui permet d'accentuer les données.
<!-- comment -->
C'est ce que nous appelons l' [idiome des facettes économes en espace](Ch99-appendix.html#space-saving-facets) qui est généralement utile dans tout ggplot avec des facettes.

<!-- comment -->

Dans la visualisation ci-dessus, les étiquettes de texte se chevauchent un peu, ce qui peut être corrigé par l'une des méthodes suivantes (exercice pour le lecteur).

<!-- comment -->

* en utilisant l'argument `breaks` de `scale\_x\_continuous()`
<!-- comment -->
* ren réduisant la taille du texte avec `theme()`  et `element\_text()`
<!-- comment -->
* en augmentant la largeur du tracé à l'aide de `theme\_animint()` voir [Chapitre 6](Ch06-other.html#plot-height-width)  pour plus d'informations.

<!-- comment -->

### Mêmes geoms dans chaque panneau (réalisation de sous-ensembles de données) {#compare-data-subsets}

<!-- comment -->

La deuxième raison d'utiliser des graphes avec plusieurs panneaux dans une visualisation de données est de comparer des sous-ensembles d'observations.
<!-- comment -->
Cela facilite la comparaison entre les sous-ensembles de données et peut être utilisé dans au moins deux situations différentes :

<!-- comment -->

* L'ensemble de données d'un geom comporte trop d'observations pour être affiché de manière informative dans un seul panneau.
<!-- comment -->
* Vous souhaitez comparer différents sous-ensembles de données tracées pour un geom

<!-- comment -->

Prenons l'exemple de l'esquisse ci-dessous.

<!-- comment -->

![World Bank panels plot](Ch02-viz-panels.png)

<!-- comment -->

Notez que les trois panneaux tracent les deux mêmes geoms (point et path).
<!-- comment -->
Puisque `facet=show.year` et qu'il y a trois panneaux, nous devrons créer des tableaux de données qui auront trois valeurs pour la variable `show.year`.
<!-- comment -->
Le `geom\_point`  ne contient des données que pour 3 ans, et le tableau `geom\_path` a des données pour 15 ans (mais 3 valeurs de `show.year`).
<!-- comment -->
Le code ci-dessous crée ces deux ensembles de données pour trois années de l'ensemble de données de la Banque mondiale.

<!-- comment -->

```{r}
show.point.list <- list()
show.path.list <- list()
for(show.year in c(1975, 1985, 1995)){
  show.point.list[[paste(show.year)]] <- data.frame(
    show.year, subset(WorldBank, year==show.year))
  show.path.list[[paste(show.year)]] <- data.frame(
    show.year, subset(WorldBank, show.year - 5 <= year & year <= show.year))
}
show.point <- do.call(rbind, show.point.list)
show.path <- do.call(rbind, show.path.list)
```

<!-- comment -->

Nous avons utilisé une boucle for sur trois valeurs de `show.year` la variable que nous utiliserons plus tard dans `facet\_grid`.
<!-- comment -->
Pour chaque valeur de `show.year` nous stockons un sous-ensemble de données sous la forme d'un élément nommé d'une liste.
<!-- comment -->
Après la boucle for, nous utilisons `do.call`  avec `rbind`  pour combiner les sous-ensembles de données.
<!-- comment -->
Il s'agit d'un exemple de la méthode [liste detableau de données idiome](Ch99-appendix.html#list-of-data-tables) qui est généralement utile pour la visualisation interactive des données.

<!-- comment -->

Ci-dessous, nous appliquons lesfacettes sur la variable `show.year`  pour créer une visualisation de données avec trois panneaux.

<!-- comment -->

```{r Ch02-viz-panels}
animint(
  scatter=ggplot()+
    geom_point(aes(
      x=life.expectancy, y=fertility.rate, color=Region),
      data=show.point)+
    geom_path(aes(
      x=life.expectancy, y=fertility.rate, color=Region,
      group=country),
      data=show.path)+
    facet_grid(. ~ show.year)+
    theme_bw())
```

<!-- comment -->

La visualisation de données ci-dessus contient un seul ggplot avec trois panneaux
<!-- comment -->
Elle montre une plus grande partie de l'ensemble des données de la Banque mondiale que les visualisations précédentes qui ne montraient que les données de 1975.
<!-- comment -->
Cependant, elle ne montre qu'un sous-ensemble de données relativement restreint.
<!-- comment -->
Vous pourriez être tenté d'utiliser un panneau pour afficher chaque année (pas seulement 1975, 1985 et 1995).
<!-- comment -->
Sachez toutefois que ce type de visualisation de données à plusieurs panneaux n'est utile que s'il n'y a que quelques sous-ensembles de données.
<!-- comment -->
Au-delà d'une dizaine de panneaux, il devient difficile de voir toutes les données en même temps, et donc de faire des comparaisons significatives.

<!-- comment -->

Au lieu de montrer toutes les données en même temps, nous pouvons créer une visualisation de données animée qui montre à l'observateur différents sous-ensembles de données au fil du temps.
<!-- comment -->
Dans le [chapitre suivant](Ch03-showSelected.html) nous montrerons comment le nouveau mot clé `showSelected`  peut être utilisé pour réaliser une animation, et nous révélerons plus de détails sur cet ensemble de données.

<!-- comment -->

## Résumé du chapitre et exercices {#exercises}

<!-- comment -->

Ce chapitre a présenté les bases de la visualisation de données statiques à l'aide de ggplot2.
<!-- comment -->
Nous avons montré comment animint peut être utilisé pour afficher une liste de ggplots dans un explorateur web.
<!-- comment -->
Nous avons expliqué deux caractéristiques de ggplot2 qui le rendent idéal pour la visualisation de données : les graphiques multicouches et multi-panneaux.

<!-- comment -->

Exercices :

<!-- comment -->

* Quels sont les trois principaux avantages de `ggplot2`  par rapport aux systèmes de tracé antérieurs tels que `grid`  et `lattice` ?
<!-- comment -->
* Quel est l'objectif des graphiques multicouches ?
<!-- comment -->
* Quelles sont les deux raisons différentes de créer des graphiques à panneaux multiples ? Lequel de ces deux types est utile pour l'interactivité ?
<!-- comment -->
* Définissons "A < B" comme signifiant qu'"un B peut contenir plusieurs A". Laquelle des affirmations suivantes est vraie ?
<!-- comment -->
	* ggplot < panel
  <!-- comment -->
	* panel < ggplot
  <!-- comment -->
	* ggplot < animint
  <!-- comment -->
	* animint < ggplot
  <!-- comment -->
	* layer < panel
  <!-- comment -->
	* panel < layer
  <!-- comment -->
	* layer < ggplot
  <!-- comment -->
	* ggplot < layer
  <!-- comment -->
	
* Dans les facettes `viz.aligned`, pourquoi est-il important d'utiliser l'argument `scales="free"` ?
<!-- comment -->
* Dans `viz.aligned`  nous avons montré un ggplot avec un panneau de nuage de points à gauche et un panneau de séries temporelles à droite. Réalisez une autre version de la visualisation de données avec le panneau des séries temporelles à gauche et le panneau du nuage de points à droite.
<!-- comment -->
* Dans `viz.aligned`  le nuage de points affiche le taux de fécondité et l'espérance de vie, mais la série chronologique n'affiche que le taux de fécondité. Réalisez une autre version de la visualisation de données qui montre les deux séries temporelles. Conseil : utilisez les panneaux horizontaux et verticaux dans `facet\_grid`.
<!-- comment -->
* Utilisez `aes(size=population)`  dans le nuage de points pour indiquer la population de chaque pays. Indice : `scale\_size\_animint(pixel.range=c(5, 10))`  signifie que des cercles d'un rayon de 5/10 pixels doivent être utilisés pour représenter la population minimale/maximale.
<!-- comment -->
* Créez une visualisation de données à plusieurs panneaux qui montre chaque année de la `WorldBank`  dans un panneau séparé. Quelles sont les limites de l'utilisation de graphiques statiques pour visualiser ces données ?
<!-- comment -->
* Créez un `viz.aligned`  en utilisant un système de tracé qui n'est pas basé sur la grammaire des graphiques. Par exemple, vous pouvez utiliser les fonctions du package `graphics` dans R ( `plot` , `points` , `lines` etc.), ou matplotlib en Python. Quels sont les avantages de ggplot2 et animint ?

<!-- comment -->

Suivant, [Chapitre 3](Ch03-showSelected.html)  explique le mot-clé `showSelected`  qui indique une variable à utiliser pour le sous-ensemble des données avant le tracé.
